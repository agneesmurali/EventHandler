{% extends "base.html" %}

{% block title %}Utilization Report - Event Scheduling System{% endblock %}

{% block content %}

<style>
    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        padding: 25px;
        border-radius: 14px;
        color: white;
        box-shadow: 0 8px 18px rgba(0,0,0,0.15);
        margin-bottom: 30px;
    }

    .btn-generate {
        background: #617bff;
        border-radius: 12px;
        padding: 15px 10px;
        font-size: 16px;
        font-weight: 600;
        color: white;
    }

    .btn-generate:hover {
        background: #4d65e6;
    }

    .report-card {
        border-radius: 14px;
    }

    .report-card-header {
        background: #2575fc;
        color: white;
        border-top-left-radius: 14px;
        border-top-right-radius: 14px;
        padding: 15px;
    }

    .badge-type {
        background: #00cfe8 !important;
        padding: 7px 12px;
        border-radius: 12px;
        font-weight: 600;
    }

    .badge-hours {
        background: #28c76f !important;
        padding: 8px 14px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
    }

    .custom-table thead {
        background: #1d1f27;
        color: #fff;
    }
</style>


<!-- Page Header -->
<div class="page-header">
    <h2 class="mb-1"><i class="bi bi-graph-up"></i> Resource Utilization Report</h2>
    <p class="text-light">Analyze resource usage and upcoming bookings within a selected date range.</p>
</div>


<!-- Date Range Card -->
<div class="card report-card mb-4">
    <div class="report-card-header">
        <h5 class="mb-0">Select Date Range</h5>
    </div>

    <div class="card-body">
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}

            <!-- PERFECTLY ALIGNED ROW -->
            <div class="row align-items-end">

                <div class="col-md-5 mb-3">
                    {{ form.start_date.label(class="form-label fw-bold") }}
                    {{ form.start_date(class="form-control") }}
                </div>

                <div class="col-md-5 mb-3">
                    {{ form.end_date.label(class="form-label fw-bold") }}
                    {{ form.end_date(class="form-control") }}
                </div>

                <!-- Generate Report Button -->
                <div class="col-md-2 mb-3">
                    <button type="submit" class="btn btn-generate w-100">
                        <i class="bi bi-search"></i> Generate<br>Report
                    </button>
                </div>

            </div>
        </form>
    </div>
</div>


<!-- Report Results -->
{% if report_data %}
<div class="card report-card">
    <div class="report-card-header">
        <h5 class="mb-0">Utilization Report Results</h5>
    </div>

    <div class="card-body">
        <div class="table-responsive custom-table">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Resource Name</th>
                        <th>Type</th>
                        <th>Total Hours Utilized</th>
                        <th>Upcoming Bookings</th>
                    </tr>
                </thead>

                <tbody>
                    {% for item in report_data %}
                    <tr>
                        <td><strong>{{ item.resource.resource_name }}</strong></td>

                        <td><span class="badge-type">{{ item.resource.resource_type }}</span></td>

                        <td><span class="badge-hours">{{ item.total_hours }} hours</span></td>

                        <td>
                            {% if item.upcoming_bookings %}
                                <ul class="list-unstyled mb-0">
                                    {% for booking in item.upcoming_bookings %}
                                    <li class="mb-2">
                                        <i class="bi bi-calendar-event"></i>
                                        <strong>{{ booking.title }}</strong><br>
                                        <small class="text-muted">
                                            {{ booking.start_time.strftime('%Y-%m-%d %H:%M') }}
                                            â†’
                                            {{ booking.end_time.strftime('%Y-%m-%d %H:%M') }}
                                        </small>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <span class="text-muted">No upcoming bookings</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
